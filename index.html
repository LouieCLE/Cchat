<!DOCTYPE html>
<html>
<head>
  <title>CChat Firebase</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #121212; color: white; }
    #chat { max-height: 400px; overflow-y: auto; margin-bottom: 10px; border: 1px solid #333; padding: 10px; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; }
  </style>
</head>
<body>
  <h2>CChat Firebase</h2>
  <div id="chat"></div>
  <input id="username" placeholder="Username">
  <input id="message" placeholder="Type your message...">
  <button onclick="sendMessage()">Send</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD0YfxI_N4Hr0PYc-KBe4JbkHKHw2wwW8E",
      authDomain: "cchat-36056.firebaseapp.com",
      projectId: "cchat-36056",
      storageBucket: "cchat-36056.appspot.com",
      messagingSenderId: "1029831019837",
      appId: "1:1029831019837:web:9772b48ce64630e0ac4954"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const chatRef = collection(db, "messages");

    // Display chat history live
    const chatBox = document.getElementById("chat");
    const q = query(chatRef, orderBy("timestamp"));
    onSnapshot(q, (snapshot) => {
      chatBox.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        chatBox.innerHTML += `<div><strong>${data.username}:</strong> ${data.message}</div>`;
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    window.sendMessage = async () => {
      const username = document.getElementById("username").value;
      const message = document.getElementById("message").value;
      if (username && message) {
        await addDoc(chatRef, {
          username,
          message,
          timestamp: Date.now()
        });
        document.getElementById("message").value = "";
      }
    };
  </script>
</body>
</html>
